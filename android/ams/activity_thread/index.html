
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Activity框架03-ActivityThread">
      
      
        <meta name="author" content="Solo">
      
      
        <link rel="canonical" href="https://0.0.0.0:8000/android/ams/activity_thread/">
      
      
        <link rel="prev" href="../activity_client_record/">
      
      
        <link rel="next" href="../activity_context/">
      
      
      <link rel="icon" href="../../../assets/images/logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Activity框架03-ActivityThread - Solo's Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../fonts/lxgw-wenkai.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../stylesheets/extra2.css">
    
      <link rel="stylesheet" href="../../../stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="../../../stylesheets/bannerSlider.css">
    
      <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      



<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="页眉">
        <a href="../../.." title="Solo&#39;s Blog"
           class="md-header__button md-logo" aria-label="Solo's Blog" data-md-component="logo">
            
  <img src="../../../assets/images/logo.png" alt="logo">

        </a>
        <label class="md-header__button md-icon" for="__drawer">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
        </label>
        <div class="md-header__title" data-md-component="header-title">
            <div class="md-header__ellipsis">
                <div class="md-header__topic">
          <span class="md-ellipsis">
            Solo's Blog
          </span>
                </div>
                <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Activity框架03-ActivityThread
            
          </span>
                </div>
            </div>
        </div>
        
        



<div class="md-copyright">
    
    <font color=#608DBD size=3>
        <span id="jinrishici-sentence">正在加载今日诗词....</span>
        <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    </font>
    

    
</div>
        
        
        
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="purple"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
        
        
        
        <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
        
        
        
        <label class="md-header__button md-icon" for="__search">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
        
        <div class="md-header__source">
            <a href="https://github.com/i-rtfsc/note" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    i-rtfsc/note
  </div>
</a>
        </div>
        
    </nav>
    
    
    
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../brightness/automatic-brightness-intro/" class="md-tabs__link">
          
  
    
  
  Android

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../base/51-android-rules/" class="md-tabs__link">
          
  
    
  
  基础技术

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../development-board/raspberry-pi/intro/" class="md-tabs__link">
          
  
    
  
  开发板

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../source-code/personal-source-code-intro/" class="md-tabs__link">
          
  
    
  
  源码工程

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
    
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Solo&#39;s Blog" class="md-nav__button md-logo" aria-label="Solo's Blog" data-md-component="logo">
      
  <img src="../../../assets/images/logo.png" alt="logo">

    </a>
    Solo's Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/i-rtfsc/note" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    i-rtfsc/note
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Android
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../brightness/automatic-brightness-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android自动背光机制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tombstones/tombstones-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NativeTombstoneManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../bootanimation/bootanimation-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bootanimation程序简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AMS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            AMS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../launch-modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity四大启动模式
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../client_transaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity框架01-客户端事务管理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity_client_record/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity框架02-ActivityClientRecord
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Activity框架03-ActivityThread
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Activity框架03-ActivityThread
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      背景
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      类图
    </span>
  </a>
  
    <nav class="md-nav" aria-label="类图">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentation" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythread_1" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread核心代码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythreadmain" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.main()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ActivityThread.main()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadattach" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.attach()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activitymanagerserviceattachapplication" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityManagerService.attachApplication()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amsactivitythread" class="md-nav__link">
    <span class="md-ellipsis">
      AMS与ActivityThread通讯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AMS与ActivityThread通讯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitymanagerserviceattachapplicationlocked" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityManagerService.attachApplicationLocked()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applicationthreadbindapplication" class="md-nav__link">
    <span class="md-ellipsis">
      ApplicationThread.bindApplication()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主线程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadsendmessage" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.sendMessage()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hhandlemessage" class="md-nav__link">
    <span class="md-ellipsis">
      H.handleMessage()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instrumentation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythreadactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread执行Activity生命周期
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ActivityThread执行Activity生命周期">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadhandlelaunchactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.handleLaunchActivity()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activitythreadperformlaunchactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.performLaunchActivity()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentationnewactivity" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation.newActivity()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instrumentation.newActivity()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#appcomponentfactoryinstantiateactivity" class="md-nav__link">
    <span class="md-ellipsis">
      AppComponentFactory.instantiateActivity()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentationcallactivityoncreate" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation.callActivityOnCreate()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instrumentation.callActivityOnCreate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activityperformcreate" class="md-nav__link">
    <span class="md-ellipsis">
      Activity.performCreate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activityoncreate" class="md-nav__link">
    <span class="md-ellipsis">
      Activity.onCreate()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../activity_context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity框架04-Activity和Context的关系
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Activity生命周期
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../android11-activity-start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android11 Activity启动流程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wm-layout-params/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WindowManager.LayoutParams
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../frida-dump-activity-lifecycle/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    frida dump activity生命周期
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5" >
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Broadcast
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            Broadcast
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../broadcast/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Broadcast概述
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" >
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    SELinux
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            SELinux
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../selinux/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android SELinux介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../selinux/genfscon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    genfscon
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" >
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Binder
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            Binder
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/android12-native-binder-change/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 12 Native Binder 代码变迁
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/ashmem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ashmem简介（Android IPC传输大数据）
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/driver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder机制01-驱动
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/service-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder机制02-ServiceManager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/framework-native/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder机制03-Framework-Native
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/framework-java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder机制04-Framework-Java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/aidl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder机制05-AIDL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binder概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../binder/am-trace-ipc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    am trace-ipc 分析
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Car
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Car
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_1" >
        
          
          <label class="md-nav__link" for="__nav_2_8_1" id="__nav_2_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    CarService
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8_1">
            <span class="md-nav__icon md-icon"></span>
            CarService
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/start-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码01-服务启动
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/init-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码02-服务初始化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/all-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码03-服务及接口
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/carservice-call-vhal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码04-CarService与Vehicle HAL交互
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/system-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码05-SystemInterface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/car-input-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码06-CarInputService
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/carservice/car-wifi-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 15 CarService源码07-CarWifiService
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8_2" >
        
          
          <label class="md-nav__link" for="__nav_2_8_2" id="__nav_2_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Vehicle
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_8_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8_2">
            <span class="md-nav__icon md-icon"></span>
            Vehicle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/vehicle/android-s-hal-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android-S Vehicle HAL架构
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../car/vehicle/android-u-hal-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android-U Vehicle HAL架构
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Input
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Input
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/focused-window/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 窗口焦点介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/inotify-epoll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    INotify与Epoll机制
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/inputDispatcher-inputChannel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InputDispatcher与InputChannel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input概述
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input系统01-Input启动过程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/input-reader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Input系统02-InputReader线程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/scancode-keycode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scancode到Keycode的映射
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../input/add-new-key/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    新增物理按键处理流程
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基础与工具
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            基础与工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/adb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ADB
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/api-levels/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android API Levels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/as-shortcut-keys/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android Studio 快捷键
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/as-compdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compdb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/c-ifdef/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    c代码中 ifdef 多条件判断
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/repo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    repo常用操作
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/ccache/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    使用ccache加快编译速度
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../base-tools/winscope/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    编译winscope
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    巧夺天工
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            巧夺天工
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../divine-skill/android-bp-if-else/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android.bp 添加宏控
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../divine-skill/service-extra-func-without-aidl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aosp原生Service快捷扩展接口
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../divine-skill/mem-pressure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    内存加压
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../divine-skill/log-to-line-chart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通过log中的坐标转成折线图
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12" >
        
          
          <label class="md-nav__link" for="__nav_2_12" id="__nav_2_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    调试技巧
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12">
            <span class="md-nav__icon md-icon"></span>
            调试技巧
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/tomestone-stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android Native crash tomestone trace tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/call-stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android打印函数调用流程
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/am-set-debug-app/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    am set-debug-app 介绍
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/privapp-permissions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    privapp permissions检查
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/event-log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    借助 event log 有效排查问题
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/merge-sort-log/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    按时间顺序合并log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/jdwp-enabled/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    无法打断点调试
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_12_8" >
        
          
          <label class="md-nav__link" for="__nav_2_12_8" id="__nav_2_12_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    调频命令
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_12_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_12_8">
            <span class="md-nav__icon md-icon"></span>
            调频命令
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/frequency/cpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CPU提频命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debug-skill/frequency/gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GPU提频命令
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_13" >
        
          
          <label class="md-nav__link" for="__nav_2_13" id="__nav_2_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    问题及方案
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_13">
            <span class="md-nav__icon md-icon"></span>
            问题及方案
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../issue-solution/set-affinity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android进程绑核方案
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../issue_solution/car-service-updatable-call-hide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CarServiceUpdatable引用hide接口
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    基础技术
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            基础技术
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/51-android-rules/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    51-android.rules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/jar-delete/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jar包删除部分内容
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/jetbrains_directories/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JetBrains配置目录
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/git_branch_commit_single/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    git小技巧-commit single
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/hexo-next/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hexo、next主题美化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/linux-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linux service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mkdocs博客搭建
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/sshfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    sshfs命令
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/tmux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tmux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../base/tar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tar命令
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    开发板
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            开发板
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    树莓派
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            树莓派
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../development-board/raspberry-pi/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    树莓派基础配置
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    源码工程
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            源码工程
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/personal-source-code-intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    个人源码工程简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    ExtFrameworks
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            ExtFrameworks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/aosp-ext/fwk-ext/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    aosp frameworks扩展方案
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android feature
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Android feature
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/android-feature/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android Device Feature
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    As aosp
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            As aosp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    as-aosp工程简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/first-configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程001-首次配置
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/design/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程002-设计思路
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/simple-extra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程003-简单扩展
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/plugin-extra/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程004-插件扩展
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/jump-system-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程005-跳转系统源码[6.x版本默认跳转]
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/jump-aidl/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程006-aidl跳转
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/jump-cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程007-c++跳转
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/as-aosp/jump-system-code-2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    教程008-跳转系统源码[进阶版]
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Global scripts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Global scripts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../source-code/global-scripts/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    global_scripts工程简介
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      背景
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      类图
    </span>
  </a>
  
    <nav class="md-nav" aria-label="类图">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentation" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythread_1" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread核心代码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythreadmain" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.main()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ActivityThread.main()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadattach" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.attach()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activitymanagerserviceattachapplication" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityManagerService.attachApplication()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amsactivitythread" class="md-nav__link">
    <span class="md-ellipsis">
      AMS与ActivityThread通讯
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AMS与ActivityThread通讯">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitymanagerserviceattachapplicationlocked" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityManagerService.attachApplicationLocked()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#applicationthreadbindapplication" class="md-nav__link">
    <span class="md-ellipsis">
      ApplicationThread.bindApplication()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主线程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主线程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadsendmessage" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.sendMessage()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hhandlemessage" class="md-nav__link">
    <span class="md-ellipsis">
      H.handleMessage()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#instrumentation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#activitythreadactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread执行Activity生命周期
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ActivityThread执行Activity生命周期">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activitythreadhandlelaunchactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.handleLaunchActivity()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activitythreadperformlaunchactivity" class="md-nav__link">
    <span class="md-ellipsis">
      ActivityThread.performLaunchActivity()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentationnewactivity" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation.newActivity()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instrumentation.newActivity()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#appcomponentfactoryinstantiateactivity" class="md-nav__link">
    <span class="md-ellipsis">
      AppComponentFactory.instantiateActivity()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instrumentationcallactivityoncreate" class="md-nav__link">
    <span class="md-ellipsis">
      Instrumentation.callActivityOnCreate()
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Instrumentation.callActivityOnCreate()">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#activityperformcreate" class="md-nav__link">
    <span class="md-ellipsis">
      Activity.performCreate()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#activityoncreate" class="md-nav__link">
    <span class="md-ellipsis">
      Activity.onCreate()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

<nav class="md-tags" >
  
    
    
      
      
    
    
      <span class="md-tag md-tag-icon">Android</span>
    
  
    
    
      
      
    
    
      <span class="md-tag md-tag-icon">AMS</span>
    
  
    
    
      
      
    
    
      <span class="md-tag md-tag-icon">Activity</span>
    
  
</nav>


  
    <a href="https://github.com/i-rtfsc/note/edit/main/docs/Android/AMS/Activity框架03-ActivityThread.md" title="编辑此页" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  


<h1>Activity框架03-ActivityThread</h1>

<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>基于 android-14.0.0_r45</p>
</div>
<h2 id="_1">背景<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>在 app 的冷启动流程中，AMS 会通过 startProcess() 方法一路调到 ProcessList.startProcessLocked() 方法，并设置 entryPoint 为 ActivityThread；并通过 socket 通信把消息发送给 Zygote 进程。</p>
<p>Zygote 进程的 ZygoteServer 接到信息后，解析出传过来的 entryPoint 并保存在 Arguments 的成员变量 startClass 中；最终通过反射的方式去反射其 main() 方法。也就是 ActivityThread.main() 。</p>
<p>所以 ActivityThread 是 app 进程的主入口。</p>
<h2 id="_2">类图<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="activitythread">ActivityThread<a class="headerlink" href="#activitythread" title="Permanent link">&para;</a></h3>
<details><summary>plantuml(点击展开详情)</summary>

<div class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="978px" preserveAspectRatio="true" style="background: #ffffff" version="1.1" viewBox="0 0 1663 978" width="1663px" zoomAndPan="magnify"><defs/><g><g id="elem_ActivityClientRecord"><rect codeLine="5" fill="#F1F1F1" height="178.375" id="ActivityClientRecord" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="233.7715" x="170.9" y="7"/><ellipse cx="212.6267" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M215.5954,28.6406 Q215.0173,28.9375 214.3767,29.0781 Q213.736,29.2344 213.0329,29.2344 Q210.5329,29.2344 209.2048,27.5938 Q207.8923,25.9375 207.8923,22.8125 Q207.8923,19.6875 209.2048,18.0313 Q210.5329,16.375 213.0329,16.375 Q213.736,16.375 214.3767,16.5313 Q215.0329,16.6875 215.5954,16.9844 L215.5954,19.7031 Q214.9704,19.125 214.3767,18.8594 Q213.7829,18.5781 213.1579,18.5781 Q211.8142,18.5781 211.1267,19.6563 Q210.4392,20.7188 210.4392,22.8125 Q210.4392,24.9063 211.1267,25.9844 Q211.8142,27.0469 213.1579,27.0469 Q213.7829,27.0469 214.3767,26.7813 Q214.9704,26.5 215.5954,25.9219 L215.5954,28.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.3789" x="232.5659" y="27.8467">ActivityClientRecord</text><line style="stroke:#181818;stroke-width:0.5;" x1="171.9" x2="403.6715" y1="39" y2="39"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="181.9,48.6484,177.9,54.6484,185.9,54.6484" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113.374" x="190.9" y="55.9951">activity: Activity</text><rect fill="#FFFFFF" fill-opacity="0.00000" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="178.9" y="65.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="139.5283" x="190.9" y="72.292">mLifecycleState: int</text><ellipse cx="181.9" cy="85.2422" fill="#FFFFFF" fill-opacity="0.00000" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="98.5674" x="190.9" y="88.5889">token: IBinder</text><line style="stroke:#181818;stroke-width:0.5;" x1="171.9" x2="403.6715" y1="95.8906" y2="95.8906"/><ellipse cx="181.9" cy="109.5391" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="207.7715" x="190.9" y="112.8857">ActivityClientRecord(IBinder):</text><ellipse cx="181.9" cy="125.8359" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="158.0195" x="190.9" y="129.1826">ActivityClientRecord():</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="178.9" y="139.1328"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71.8594" x="190.9" y="145.4795">init(): void</text><ellipse cx="181.9" cy="158.4297" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126.4238" x="190.9" y="161.7764">setState(int): void</text><ellipse cx="181.9" cy="174.7266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="159.8037" x="190.9" y="178.0732">getLifecycleState(): int</text></g><g id="elem_ActivityThread"><rect codeLine="15" fill="#F1F1F1" height="422.8281" id="ActivityThread" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="831.5674" x="9" y="245.38"/><ellipse cx="369.6025" cy="261.38" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M372.5713,267.0206 Q371.9932,267.3175 371.3525,267.4581 Q370.7119,267.6144 370.0088,267.6144 Q367.5088,267.6144 366.1807,265.9738 Q364.8682,264.3175 364.8682,261.1925 Q364.8682,258.0675 366.1807,256.4113 Q367.5088,254.755 370.0088,254.755 Q370.7119,254.755 371.3525,254.9113 Q372.0088,255.0675 372.5713,255.3644 L372.5713,258.0831 Q371.9463,257.505 371.3525,257.2394 Q370.7588,256.9581 370.1338,256.9581 Q368.79,256.9581 368.1025,258.0363 Q367.415,259.0988 367.415,261.1925 Q367.415,263.2863 368.1025,264.3644 Q368.79,265.4269 370.1338,265.4269 Q370.7588,265.4269 371.3525,265.1613 Q371.9463,264.88 372.5713,264.3019 L372.5713,267.0206 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101.8623" x="390.1025" y="266.2267">ActivityThread</text><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="839.5674" y1="277.38" y2="277.38"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="20,287.0284,16,293.0284,24,293.0284" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="226.8984" x="29" y="294.3751">mAppThread: ApplicationThread</text><polygon fill="#FFFFFF" fill-opacity="0.00000" points="20,303.3253,16,309.3253,24,309.3253" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="247.6523" x="29" y="310.672">mInstrumentation: Instrumentation</text><polygon fill="#FFFFFF" fill-opacity="0.00000" points="20,319.6222,16,325.6222,24,325.6222" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.1777" x="29" y="326.9689">mLooper: Looper</text><polygon fill="#FFFFFF" fill-opacity="0.00000" points="20,335.9191,16,341.9191,24,341.9191" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="378.9092" x="29" y="343.2657">mActivities: ArrayMap&lt;IBinder, ActivityClientRecord&gt;</text><polygon fill="#FFFFFF" fill-opacity="0.00000" points="20,352.2159,16,358.2159,24,358.2159" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.8594" x="29" y="359.5626">mH: H</text><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="839.5674" y1="366.8644" y2="366.8644"/><ellipse cx="20" cy="380.5128" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="117.5029" x="29" y="383.8595">ActivityThread():</text><ellipse cx="20" cy="396.8097" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="665.8477" x="29" y="400.1564">handleStopActivity(ActivityClientRecord, int, PendingTransactionActions, boolean, String): void</text><ellipse cx="20" cy="413.1066" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="805.5674" x="29" y="416.4532">handlePauseActivity(ActivityClientRecord, boolean, boolean, int, boolean, PendingTransactionActions, String): void</text><ellipse cx="20" cy="429.4034" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="328.3438" x="29" y="432.7501">getActivityClient(IBinder): ActivityClientRecord</text><ellipse cx="20" cy="445.7003" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="205.4678" x="29" y="449.047">getActivity(IBinder): Activity?</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="17" y="458.9972"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="683.6416" x="29" y="465.3439">performPauseActivity(ActivityClientRecord, boolean, String, PendingTransactionActions): Bundle?</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="17" y="475.2941"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="616.5674" x="29" y="481.6407">performStopActivityInner(ActivityClientRecord, StopInfo, boolean, boolean, String): void</text><ellipse cx="20" cy="494.5909" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="137.4023" x="29" y="497.9376">main(String[]): void</text><polygon fill="#4177AF" points="20,506.8878,16,512.8878,24,512.8878" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="563.2061" x="29" y="514.2345">performDestroyActivity(ActivityClientRecord, boolean, int, boolean, String): void</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="17" y="524.1847"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="424.8809" x="29" y="530.5314">performLaunchActivity(ActivityClientRecord, Intent): Activity</text><polygon fill="#4177AF" points="20,539.4816,16,545.4816,24,545.4816" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217.4922" x="29" y="546.8282">sendMessage(int, Object): void</text><ellipse cx="20" cy="559.7784" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="641.0332" x="29" y="563.1251">handleStartActivity(ActivityClientRecord, PendingTransactionActions, ActivityOptions): void</text><ellipse cx="20" cy="576.0753" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="554.7773" x="29" y="579.422">handleDestroyActivity(ActivityClientRecord, boolean, int, boolean, String): void</text><ellipse cx="20" cy="592.3722" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="594.4736" x="29" y="595.7189">handleResumeActivity(ActivityClientRecord, boolean, boolean, boolean, String): void</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="17" y="605.6691"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336.6699" x="29" y="612.0157">sendMessage(int, Object, int, int, boolean): void</text><rect fill="#F24D5C" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="17" y="621.9659"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="189.5127" x="29" y="628.3126">attach(boolean, long): void</text><ellipse cx="20" cy="641.2628" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="499.502" x="29" y="644.6095">performResumeActivity(ActivityClientRecord, boolean, String): boolean</text><ellipse cx="20" cy="657.5597" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="649.9336" x="29" y="660.9064">handleLaunchActivity(ActivityClientRecord, PendingTransactionActions, int, Intent): Activity?</text></g><g id="elem_ApplicationThread"><rect codeLine="40" fill="#F1F1F1" height="80.5938" id="ApplicationThread" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="339.8789" x="795.84" y="55.89"/><ellipse cx="897.7878" cy="71.89" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M900.7565,77.5306 Q900.1784,77.8275 899.5378,77.9681 Q898.8971,78.1244 898.194,78.1244 Q895.694,78.1244 894.3659,76.4837 Q893.0534,74.8275 893.0534,71.7025 Q893.0534,68.5775 894.3659,66.9212 Q895.694,65.265 898.194,65.265 Q898.8971,65.265 899.5378,65.4212 Q900.194,65.5775 900.7565,65.8744 L900.7565,68.5931 Q900.1315,68.015 899.5378,67.7494 Q898.944,67.4681 898.319,67.4681 Q896.9753,67.4681 896.2878,68.5462 Q895.6003,69.6087 895.6003,71.7025 Q895.6003,73.7962 896.2878,74.8744 Q896.9753,75.9369 898.319,75.9369 Q898.944,75.9369 899.5378,75.6712 Q900.1315,75.39 900.7565,74.8119 L900.7565,77.5306 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.4834" x="918.2878" y="76.7367">ApplicationThread</text><line style="stroke:#181818;stroke-width:0.5;" x1="796.84" x2="1134.7189" y1="87.89" y2="87.89"/><line style="stroke:#181818;stroke-width:0.5;" x1="796.84" x2="1134.7189" y1="95.89" y2="95.89"/><ellipse cx="806.84" cy="109.5384" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="143.124" x="815.84" y="112.8851">ApplicationThread():</text><ellipse cx="806.84" cy="125.8353" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="313.8789" x="815.84" y="129.182">bindApplication(String, ApplicationInfo): void</text></g><g id="elem_ClientTransactionHandler"><rect codeLine="44" fill="#F1F1F1" height="243.5625" id="ClientTransactionHandler" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="831.5674" x="9" y="728.21"/><ellipse cx="331.6323" cy="744.21" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M334.6011,749.8506 Q334.0229,750.1475 333.3823,750.2881 Q332.7417,750.4444 332.0386,750.4444 Q329.5386,750.4444 328.2104,748.8038 Q326.8979,747.1475 326.8979,744.0225 Q326.8979,740.8975 328.2104,739.2413 Q329.5386,737.585 332.0386,737.585 Q332.7417,737.585 333.3823,737.7413 Q334.0386,737.8975 334.6011,738.1944 L334.6011,740.9131 Q333.9761,740.335 333.3823,740.0694 Q332.7886,739.7881 332.1636,739.7881 Q330.8198,739.7881 330.1323,740.8663 Q329.4448,741.9288 329.4448,744.0225 Q329.4448,746.1163 330.1323,747.1944 Q330.8198,748.2569 332.1636,748.2569 Q332.7886,748.2569 333.3823,747.9913 Q333.9761,747.71 334.6011,747.1319 L334.6011,749.8506 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="177.8027" x="352.1323" y="749.0567">ClientTransactionHandler</text><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="839.5674" y1="760.21" y2="760.21"/><line style="stroke:#181818;stroke-width:0.5;" x1="10" x2="839.5674" y1="768.21" y2="768.21"/><ellipse cx="20" cy="781.8584" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="193.4434" x="29" y="785.2051">ClientTransactionHandler():</text><ellipse cx="20" cy="798.1553" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="198.0371" x="29" y="801.502">getActivity(IBinder): Activity</text><ellipse cx="20" cy="814.4522" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="642.5029" x="29" y="817.7989">handleLaunchActivity(ActivityClientRecord, PendingTransactionActions, int, Intent): Activity</text><ellipse cx="20" cy="830.7491" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="556.4385" x="29" y="834.0957">handleRelaunchActivity(ActivityClientRecord, PendingTransactionActions): void</text><polygon fill="#4177AF" points="20,843.0459,16,849.0459,24,849.0459" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="317.2832" x="29" y="850.3926">scheduleTransaction(ClientTransaction): void</text><ellipse cx="20" cy="863.3428" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="665.8477" x="29" y="866.6895">handleStopActivity(ActivityClientRecord, int, PendingTransactionActions, boolean, String): void</text><ellipse cx="20" cy="879.6397" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="805.5674" x="29" y="882.9864">handlePauseActivity(ActivityClientRecord, boolean, boolean, int, boolean, PendingTransactionActions, String): void</text><polygon fill="#4177AF" points="20,891.9366,16,897.9366,24,897.9366" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="217.4922" x="29" y="899.2832">sendMessage(int, Object): void</text><ellipse cx="20" cy="912.2334" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="594.4736" x="29" y="915.5801">handleResumeActivity(ActivityClientRecord, boolean, boolean, boolean, String): void</text><ellipse cx="20" cy="928.5303" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="554.7773" x="29" y="931.877">handleDestroyActivity(ActivityClientRecord, boolean, int, boolean, String): void</text><ellipse cx="20" cy="944.8272" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="641.0332" x="29" y="948.1739">handleStartActivity(ActivityClientRecord, PendingTransactionActions, ActivityOptions): void</text><ellipse cx="20" cy="961.1241" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="328.3438" x="29" y="964.4707">getActivityClient(IBinder): ActivityClientRecord</text></g><g id="elem_Default"><rect codeLine="58" fill="#F1F1F1" height="96.8906" id="Default" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="339.8789" x="1240.84" y="408.35"/><ellipse cx="1380.9528" cy="424.35" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M1383.9215,429.9906 Q1383.3434,430.2875 1382.7028,430.4281 Q1382.0622,430.5844 1381.359,430.5844 Q1378.859,430.5844 1377.5309,428.9438 Q1376.2184,427.2875 1376.2184,424.1625 Q1376.2184,421.0375 1377.5309,419.3813 Q1378.859,417.725 1381.359,417.725 Q1382.0622,417.725 1382.7028,417.8813 Q1383.359,418.0375 1383.9215,418.3344 L1383.9215,421.0531 Q1383.2965,420.475 1382.7028,420.2094 Q1382.109,419.9281 1381.484,419.9281 Q1380.1403,419.9281 1379.4528,421.0063 Q1378.7653,422.0688 1378.7653,424.1625 Q1378.7653,426.2563 1379.4528,427.3344 Q1380.1403,428.3969 1381.484,428.3969 Q1382.109,428.3969 1382.7028,428.1313 Q1383.2965,427.85 1383.9215,427.2719 L1383.9215,429.9906 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51.1533" x="1401.4528" y="429.1967">Default</text><line style="stroke:#181818;stroke-width:0.5;" x1="1241.84" x2="1579.7189" y1="440.35" y2="440.35"/><line style="stroke:#181818;stroke-width:0.5;" x1="1241.84" x2="1579.7189" y1="448.35" y2="448.35"/><ellipse cx="1251.84" cy="461.9984" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66.7939" x="1260.84" y="465.3451">Default():</text><ellipse cx="1251.84" cy="478.2953" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="313.8789" x="1260.84" y="481.642">bindApplication(String, ApplicationInfo): void</text><ellipse cx="1251.84" cy="494.5922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131.3389" x="1260.84" y="497.9389">asBinder(): IBinder</text></g><g id="elem_H"><rect codeLine="63" fill="#F1F1F1" height="96.8906" id="H" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="246.1514" x="439.71" y="47.75"/><ellipse cx="553.272" cy="63.75" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M556.2408,69.3906 Q555.6626,69.6875 555.022,69.8281 Q554.3814,69.9844 553.6783,69.9844 Q551.1783,69.9844 549.8501,68.3438 Q548.5376,66.6875 548.5376,63.5625 Q548.5376,60.4375 549.8501,58.7813 Q551.1783,57.125 553.6783,57.125 Q554.3814,57.125 555.022,57.2813 Q555.6783,57.4375 556.2408,57.7344 L556.2408,60.4531 Q555.6158,59.875 555.022,59.6094 Q554.4283,59.3281 553.8033,59.3281 Q552.4595,59.3281 551.772,60.4063 Q551.0845,61.4688 551.0845,63.5625 Q551.0845,65.6563 551.772,66.7344 Q552.4595,67.7969 553.8033,67.7969 Q554.4283,67.7969 555.022,67.5313 Q555.6158,67.25 556.2408,66.6719 L556.2408,69.3906 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="10.5273" x="573.772" y="68.5967">H</text><line style="stroke:#181818;stroke-width:0.5;" x1="440.71" x2="684.8614" y1="79.75" y2="79.75"/><ellipse cx="450.71" cy="93.3984" fill="#FFFFFF" fill-opacity="0.00000" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161.3213" x="459.71" y="96.7451">BIND_APPLICATION: int</text><line style="stroke:#181818;stroke-width:0.5;" x1="440.71" x2="684.8614" y1="104.0469" y2="104.0469"/><ellipse cx="450.71" cy="117.6953" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="26.168" x="459.71" y="121.042">H():</text><ellipse cx="450.71" cy="133.9922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="220.1514" x="459.71" y="137.3389">handleMessage(Message): void</text></g><g id="elem_IApplicationThread"><rect codeLine="68" fill="#F1F1F1" height="72.5625" id="IApplicationThread" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="339.8789" x="1240.84" y="813.71"/><ellipse cx="1340.7233" cy="833.8428" fill="#B4A7E5" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M1336.6452,829.6084 L1336.6452,827.4522 L1344.0358,827.4522 L1344.0358,829.6084 L1341.5671,829.6084 L1341.5671,837.6866 L1344.0358,837.6866 L1344.0358,839.8428 L1336.6452,839.8428 L1336.6452,837.6866 L1339.1139,837.6866 L1339.1139,829.6084 L1336.6452,829.6084 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacing" textLength="68.2031" x="1392.9279" y="829.8487">«interface»</text><text fill="#000000" font-family="sans-serif" font-size="14" font-style="italic" lengthAdjust="spacing" textLength="131.6123" x="1361.2233" y="845.6739">IApplicationThread</text><line style="stroke:#181818;stroke-width:0.5;" x1="1241.84" x2="1579.7189" y1="853.9756" y2="853.9756"/><line style="stroke:#181818;stroke-width:0.5;" x1="1241.84" x2="1579.7189" y1="861.9756" y2="861.9756"/><ellipse cx="1251.84" cy="875.6241" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="313.8789" x="1260.84" y="878.9707">bindApplication(String, ApplicationInfo): void</text></g><g id="elem_Proxy"><rect codeLine="71" fill="#F1F1F1" height="129.4844" id="Proxy" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="339.8789" x="1316.84" y="31.45"/><ellipse cx="1462.8625" cy="47.45" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M1465.8312,53.0906 Q1465.2531,53.3875 1464.6125,53.5281 Q1463.9718,53.6844 1463.2687,53.6844 Q1460.7687,53.6844 1459.4406,52.0437 Q1458.1281,50.3875 1458.1281,47.2625 Q1458.1281,44.1375 1459.4406,42.4812 Q1460.7687,40.825 1463.2687,40.825 Q1463.9718,40.825 1464.6125,40.9812 Q1465.2687,41.1375 1465.8312,41.4344 L1465.8312,44.1531 Q1465.2062,43.575 1464.6125,43.3094 Q1464.0187,43.0281 1463.3937,43.0281 Q1462.05,43.0281 1461.3625,44.1062 Q1460.675,45.1687 1460.675,47.2625 Q1460.675,49.3562 1461.3625,50.4344 Q1462.05,51.4969 1463.3937,51.4969 Q1464.0187,51.4969 1464.6125,51.2312 Q1465.2062,50.95 1465.8312,50.3719 L1465.8312,53.0906 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.334" x="1483.3625" y="52.2967">Proxy</text><line style="stroke:#181818;stroke-width:0.5;" x1="1317.84" x2="1655.7189" y1="63.45" y2="63.45"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="1324.84" y="74.0984"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="127.2031" x="1336.84" y="80.4451">mRemote: IBinder</text><line style="stroke:#181818;stroke-width:0.5;" x1="1317.84" x2="1655.7189" y1="87.7469" y2="87.7469"/><polygon fill="#4177AF" points="1327.84,97.3953,1323.84,103.3953,1331.84,103.3953" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.7266" x="1336.84" y="104.742">Proxy(IBinder):</text><ellipse cx="1327.84" cy="117.6922" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="220.2676" x="1336.84" y="121.0389">getInterfaceDescriptor(): String</text><ellipse cx="1327.84" cy="133.9891" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="313.8789" x="1336.84" y="137.3357">bindApplication(String, ApplicationInfo): void</text><ellipse cx="1327.84" cy="150.2859" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131.3389" x="1336.84" y="153.6326">asBinder(): IBinder</text></g><g id="elem_Stub"><rect codeLine="78" fill="#F1F1F1" height="178.375" id="Stub" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="329.4814" x="876.04" y="367.61"/><ellipse cx="1020.4629" cy="383.61" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M1023.4316,389.2506 Q1022.8535,389.5475 1022.2129,389.6881 Q1021.5722,389.8444 1020.8691,389.8444 Q1018.3691,389.8444 1017.041,388.2038 Q1015.7285,386.5475 1015.7285,383.4225 Q1015.7285,380.2975 1017.041,378.6413 Q1018.3691,376.985 1020.8691,376.985 Q1021.5722,376.985 1022.2129,377.1413 Q1022.8691,377.2975 1023.4316,377.5944 L1023.4316,380.3131 Q1022.8066,379.735 1022.2129,379.4694 Q1021.6191,379.1881 1020.9941,379.1881 Q1019.6504,379.1881 1018.9629,380.2663 Q1018.2754,381.3288 1018.2754,383.4225 Q1018.2754,385.5163 1018.9629,386.5944 Q1019.6504,387.6569 1020.9941,387.6569 Q1021.6191,387.6569 1022.2129,387.3913 Q1022.8066,387.11 1023.4316,386.5319 L1023.4316,389.2506 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="32.1357" x="1040.9629" y="388.4567">Stub</text><line style="stroke:#181818;stroke-width:0.5;" x1="877.04" x2="1204.5214" y1="399.61" y2="399.61"/><ellipse cx="887.04" cy="413.2584" fill="#FFFFFF" fill-opacity="0.00000" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="140.834" x="896.04" y="416.6051">DESCRIPTOR: String</text><polygon fill="#FFFFFF" fill-opacity="0.00000" points="887.04,425.5553,883.04,431.5553,891.04,431.5553" style="stroke:#1963A0;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="243.9199" x="896.04" y="432.902">TRANSACTION_bindApplication: int</text><line style="stroke:#181818;stroke-width:0.5;" x1="877.04" x2="1204.5214" y1="440.2038" y2="440.2038"/><ellipse cx="887.04" cy="453.8522" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="47.7764" x="896.04" y="457.1989">Stub():</text><ellipse cx="887.04" cy="470.1491" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="285.1475" x="896.04" y="473.4957">getDefaultTransactionName(int): String?</text><ellipse cx="887.04" cy="486.4459" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="226.5635" x="896.04" y="489.7926">getTransactionName(int): String</text><ellipse cx="887.04" cy="502.7428" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="131.3389" x="896.04" y="506.0895">asBinder(): IBinder</text><ellipse cx="887.04" cy="519.0397" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="280.0068" x="896.04" y="522.3864">asInterface(IBinder): IApplicationThread</text><ellipse cx="887.04" cy="535.3366" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="303.4814" x="896.04" y="538.6832">onTransact(int, Parcel, Parcel, int): boolean</text></g><g id="link_ActivityClientRecord_ActivityThread"><path codeLine="89" d="M287.78,201.79 C287.78,220.25 287.78,224.43 287.78,245.17 " fill="#FFFFFF" fill-opacity="0.00000" id="ActivityClientRecord-backto-ActivityThread" style="stroke:#820000;stroke-width:1;"/><ellipse cx="287.78" cy="193.79" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="287.78" x2="287.78" y1="201.79" y2="185.79"/><line style="stroke:#820000;stroke-width:1;" x1="279.78" x2="295.78" y1="193.79" y2="193.79"/></g><g id="link_ActivityThread_ClientTransactionHandler"><path codeLine="90" d="M424.78,668.64 C424.78,688.89 424.78,690.91 424.78,709.86 " fill="#FFFFFF" fill-opacity="0.00000" id="ActivityThread-to-ClientTransactionHandler" style="stroke:#000082;stroke-width:1;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="424.78,727.86,430.78,709.86,418.78,709.86,424.78,727.86" style="stroke:#000082;stroke-width:1;"/></g><g id="link_ApplicationThread_ActivityThread"><path codeLine="91" d="M818.21,152.86 C818.21,180.58 818.21,203.65 818.21,244.99 " fill="#FFFFFF" fill-opacity="0.00000" id="ApplicationThread-backto-ActivityThread" style="stroke:#820000;stroke-width:1;"/><ellipse cx="818.21" cy="144.86" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="818.21" x2="818.21" y1="152.86" y2="136.86"/><line style="stroke:#820000;stroke-width:1;" x1="810.21" x2="826.21" y1="144.86" y2="144.86"/></g><g id="link_ApplicationThread_Stub"><path codeLine="92" d="M1005.88,136.86 C1005.88,192.39 1005.88,275.46 1005.88,349.18 " fill="#FFFFFF" fill-opacity="0.00000" id="ApplicationThread-to-Stub" style="stroke:#000082;stroke-width:1;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1005.88,367.18,1011.88,349.18,999.88,349.18,1005.88,367.18" style="stroke:#000082;stroke-width:1;"/></g><g id="link_Default_IApplicationThread"><path codeLine="93" d="M1444.77,521.4 C1444.77,601.23 1444.77,742.31 1444.77,813.45 " fill="#FFFFFF" fill-opacity="0.00000" id="Default-backto-IApplicationThread" style="stroke:#820000;stroke-width:1;"/><ellipse cx="1444.77" cy="513.4" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="1444.77" x2="1444.77" y1="521.4" y2="505.4"/><line style="stroke:#820000;stroke-width:1;" x1="1436.77" x2="1452.77" y1="513.4" y2="513.4"/></g><g id="link_Default_IApplicationThread"><path codeLine="94" d="M1512.75,505.4 C1512.75,585.23 1512.75,724.31 1512.75,795.45 " fill="#FFFFFF" fill-opacity="0.00000" id="Default-to-IApplicationThread" style="stroke:#008200;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1512.75,813.45,1518.75,795.45,1506.75,795.45,1512.75,813.45" style="stroke:#008200;stroke-width:1;"/></g><g id="link_H_ActivityThread"><path codeLine="95" d="M562.78,160.82 C562.78,187.83 562.78,207.51 562.78,245.07 " fill="#FFFFFF" fill-opacity="0.00000" id="H-backto-ActivityThread" style="stroke:#820000;stroke-width:1;"/><ellipse cx="562.78" cy="152.82" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="562.78" x2="562.78" y1="160.82" y2="144.82"/><line style="stroke:#820000;stroke-width:1;" x1="554.78" x2="570.78" y1="152.82" y2="152.82"/></g><g id="link_Proxy_IApplicationThread"><path codeLine="96" d="M1618.72,161.18 C1618.72,344.21 1618.72,850.77 1618.72,850.77 C1618.72,850.77 1621.4,850.77 1599.07,850.77 " fill="#FFFFFF" fill-opacity="0.00000" id="Proxy-to-IApplicationThread" style="stroke:#008200;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1581.07,850.77,1599.07,856.77,1599.07,844.77,1581.07,850.77" style="stroke:#008200;stroke-width:1;"/></g><g id="link_Proxy_Stub"><path codeLine="97" d="M1300.67,153.77 C1225.84,153.77 1170.62,153.77 1170.62,153.77 C1170.62,153.77 1170.62,277.75 1170.62,367.11 " fill="#FFFFFF" fill-opacity="0.00000" id="Proxy-backto-Stub" style="stroke:#820000;stroke-width:1;"/><ellipse cx="1308.67" cy="153.77" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="1300.67" x2="1316.67" y1="153.77" y2="153.77"/><line style="stroke:#820000;stroke-width:1;" x1="1308.67" x2="1308.67" y1="145.77" y2="161.77"/></g><g id="link_Stub_IApplicationThread"><path codeLine="98" d="M1221.84,519.77 C1306.81,519.77 1376.8,519.77 1376.8,519.77 C1376.8,519.77 1376.8,727.41 1376.8,813.39 " fill="#FFFFFF" fill-opacity="0.00000" id="Stub-backto-IApplicationThread" style="stroke:#820000;stroke-width:1;"/><ellipse cx="1213.84" cy="519.77" fill="#FFFFFF" rx="8" ry="8" style="stroke:#820000;stroke-width:1;"/><line style="stroke:#820000;stroke-width:1;" x1="1221.84" x2="1205.84" y1="519.77" y2="519.77"/><line style="stroke:#820000;stroke-width:1;" x1="1213.84" x2="1213.84" y1="527.77" y2="511.77"/></g><g id="link_Stub_IApplicationThread"><path codeLine="99" d="M1205.96,532.77 C1261.12,532.77 1308.82,532.77 1308.82,532.77 C1308.82,532.77 1308.82,711.79 1308.82,795.29 " fill="#FFFFFF" fill-opacity="0.00000" id="Stub-to-IApplicationThread" style="stroke:#008200;stroke-width:1;stroke-dasharray:7.0,7.0;"/><polygon fill="#FFFFFF" fill-opacity="0.00000" points="1308.82,813.29,1314.82,795.29,1302.82,795.29,1308.82,813.29" style="stroke:#008200;stroke-width:1;"/></g></g></svg></div>

</details>

<details open><summary>mermaid</summary>

<pre class="mermaid"><code>classDiagram

direction BT

class ActivityClientRecord {

+ ActivityClientRecord()

+ ActivityClientRecord(IBinder)

+ IBinder token

~ Activity activity

- int mLifecycleState

- init() void

+ setState(int) void

+ getLifecycleState() int

}

class ActivityThread {

+ ActivityThread()

~ H mH

~ Instrumentation mInstrumentation

~ ApplicationThread mAppThread

~ Looper mLooper

~ ArrayMap~IBinder, ActivityClientRecord~ mActivities

- performStopActivityInner(ActivityClientRecord, StopInfo, boolean, boolean, String) void

- sendMessage(int, Object, int, int, boolean) void

+ handleStartActivity(ActivityClientRecord, PendingTransactionActions, ActivityOptions) void

+ handleLaunchActivity(ActivityClientRecord, PendingTransactionActions, int, Intent) Activity?

+ handleResumeActivity(ActivityClientRecord, boolean, boolean, boolean, String) void

- performPauseActivity(ActivityClientRecord, boolean, String, PendingTransactionActions) Bundle?

+ handlePauseActivity(ActivityClientRecord, boolean, boolean, int, boolean, PendingTransactionActions, String) void

+ handleDestroyActivity(ActivityClientRecord, boolean, int, boolean, String) void

+ performResumeActivity(ActivityClientRecord, boolean, String) boolean

~ performDestroyActivity(ActivityClientRecord, boolean, int, boolean, String) void

+ main(String[]) void

- performLaunchActivity(ActivityClientRecord, Intent) Activity

+ getActivity(IBinder) Activity?

~ sendMessage(int, Object) void

+ handleStopActivity(ActivityClientRecord, int, PendingTransactionActions, boolean, String) void

+ getActivityClient(IBinder) ActivityClientRecord

- attach(boolean, long) void

}

class ApplicationThread {

+ ApplicationThread()

+ bindApplication(String, ApplicationInfo) void

}

class ClientTransactionHandler {

+ ClientTransactionHandler()

+ getActivity(IBinder) Activity

+ handleStartActivity(ActivityClientRecord, PendingTransactionActions, ActivityOptions) void

+ handleRelaunchActivity(ActivityClientRecord, PendingTransactionActions) void

+ handleResumeActivity(ActivityClientRecord, boolean, boolean, boolean, String) void

~ sendMessage(int, Object) void

+ getActivityClient(IBinder) ActivityClientRecord

+ handleStopActivity(ActivityClientRecord, int, PendingTransactionActions, boolean, String) void

~ scheduleTransaction(ClientTransaction) void

+ handleDestroyActivity(ActivityClientRecord, boolean, int, boolean, String) void

+ handlePauseActivity(ActivityClientRecord, boolean, boolean, int, boolean, PendingTransactionActions, String) void

+ handleLaunchActivity(ActivityClientRecord, PendingTransactionActions, int, Intent) Activity

}

class Default {

+ Default()

+ bindApplication(String, ApplicationInfo) void

+ asBinder() IBinder

}

class H {

+ H()

+ int BIND_APPLICATION

+ handleMessage(Message) void

}

class IApplicationThread {

&lt;&lt;Interface&gt;&gt;

+ bindApplication(String, ApplicationInfo) void

}

class Proxy {

~ Proxy(IBinder)

- IBinder mRemote

+ bindApplication(String, ApplicationInfo) void

+ asBinder() IBinder

+ getInterfaceDescriptor() String

}

class Stub {

+ Stub()

+ String DESCRIPTOR

~ int TRANSACTION_bindApplication

+ getDefaultTransactionName(int) String?

+ asInterface(IBinder) IApplicationThread

+ asBinder() IBinder

+ getTransactionName(int) String

+ onTransact(int, Parcel, Parcel, int) boolean

}



ActivityThread --&gt; ActivityClientRecord

ActivityThread --&gt; ClientTransactionHandler

ActivityThread --&gt; ApplicationThread

ApplicationThread --&gt; Stub

IApplicationThread --&gt; Default

Default ..&gt; IApplicationThread

ActivityThread --&gt; H

Proxy ..&gt; IApplicationThread

Stub --&gt; Proxy

Stub ..&gt; IApplicationThread

IApplicationThread --&gt; Stub</code></pre>

</details>

<p>ActivityThread 有几个比较重要的成员变量：</p>
<ul>
<li>
<p>mAppThread</p>
<blockquote>
<p>其类型为 ApplicationThread</p>
</blockquote>
</li>
<li>
<p>mH</p>
<blockquote>
<p>其类型为 Handler</p>
</blockquote>
</li>
<li>
<p>mInstrumentation</p>
<blockquote>
<p>其类型为 Instrumentation</p>
</blockquote>
</li>
<li>
<p>mActivities</p>
<blockquote>
<p>其类型为 ArrayMap <code>&lt;IBinder, ActivityClientRecord&gt;</code></p>
</blockquote>
</li>
</ul>
<p>ActivityThread 的两个内部类：</p>
<ul>
<li>H(Handler)</li>
<li>ApplicationThread</li>
</ul>
<h3 id="instrumentation">Instrumentation<a class="headerlink" href="#instrumentation" title="Permanent link">&para;</a></h3>
<details><summary>plantuml(点击展开详情)</summary>

<div class="puml"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="CLASS" height="346px" preserveAspectRatio="true" style="background: #ffffff" version="1.1" viewBox="0 0 652 346" width="652px" zoomAndPan="magnify"><defs/><g><g id="elem_Instrumentation"><rect codeLine="5" fill="#F1F1F1" height="325.0469" id="Instrumentation" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="631.6504" x="7" y="7"/><ellipse cx="262.3633" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1;"/><path d="M265.332,28.6406 Q264.7539,28.9375 264.1133,29.0781 Q263.4727,29.2344 262.7695,29.2344 Q260.2695,29.2344 258.9414,27.5938 Q257.6289,25.9375 257.6289,22.8125 Q257.6289,19.6875 258.9414,18.0313 Q260.2695,16.375 262.7695,16.375 Q263.4727,16.375 264.1133,16.5313 Q264.7695,16.6875 265.332,16.9844 L265.332,19.7031 Q264.707,19.125 264.1133,18.8594 Q263.5195,18.5781 262.8945,18.5781 Q261.5508,18.5781 260.8633,19.6563 Q260.1758,20.7188 260.1758,22.8125 Q260.1758,24.9063 260.8633,25.9844 Q261.5508,27.0469 262.8945,27.0469 Q263.5195,27.0469 264.1133,26.7813 Q264.707,26.5 265.332,25.9219 L265.332,28.6406 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112.4238" x="282.8633" y="27.8467">Instrumentation</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="637.6504" y1="39" y2="39"/><rect fill="#FFFFFF" fill-opacity="0.00000" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="15" y="49.6484"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160.3369" x="27" y="55.9951">mAppContext: Context</text><rect fill="#FFFFFF" fill-opacity="0.00000" height="6" style="stroke:#C82930;stroke-width:1;" width="6" x="15" y="65.9453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173.9268" x="27" y="72.292">mThread: ActivityThread</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="637.6504" y1="79.5938" y2="79.5938"/><ellipse cx="18" cy="93.2422" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="303.3379" x="27" y="96.5889">callActivityOnCreate(Activity, Bundle): void</text><ellipse cx="18" cy="109.5391" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="230.6992" x="27" y="112.8857">callActivityOnStop(Activity): void</text><ellipse cx="18" cy="125.8359" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.6729" x="27" y="129.1826">callActivityOnPause(Activity): void</text><ellipse cx="18" cy="142.1328" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="153.2617" x="27" y="145.4795">getContext(): Context</text><ellipse cx="18" cy="158.4297" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="467.5166" x="27" y="161.7764">callActivityOnPostCreate(Activity, Bundle, PersistableBundle): void</text><ellipse cx="18" cy="174.7266" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="333.1289" x="27" y="178.0732">callActivityOnPostCreate(Activity, Bundle): void</text><ellipse cx="18" cy="191.0234" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="296.9395" x="27" y="194.3701">callApplicationOnCreate(Application): void</text><ellipse cx="18" cy="207.3203" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="605.6504" x="27" y="210.667">execStartActivity(Context, IBinder, IBinder, Activity, Intent, int, Bundle): ActivityResult</text><ellipse cx="18" cy="223.6172" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="340.3135" x="27" y="226.9639">newActivity(ClassLoader, String, Intent): Activity</text><ellipse cx="18" cy="239.9141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="253.6543" x="27" y="243.2607">callActivityOnDestroy(Activity): void</text><ellipse cx="18" cy="256.2109" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="255.6299" x="27" y="259.5576">callActivityOnResume(Activity): void</text><ellipse cx="18" cy="272.5078" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="437.7256" x="27" y="275.8545">callActivityOnCreate(Activity, Bundle, PersistableBundle): void</text><ellipse cx="18" cy="288.8047" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="233.0713" x="27" y="292.1514">callActivityOnStart(Activity): void</text><ellipse cx="18" cy="305.1016" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="337.1895" x="27" y="308.4482">newApplication(Class&lt;?&gt;, Context): Application</text><ellipse cx="18" cy="321.3984" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="405.1797" x="27" y="324.7451">newApplication(ClassLoader, String, Context): Application</text></g></g></svg></div>
</details>

<details open><summary>mermaid</summary>

<pre class="mermaid"><code>
classDiagram

direction BT

class Instrumentation {

- Context mAppContext

- ActivityThread mThread

+ callActivityOnCreate(Activity, Bundle) void

+ callActivityOnStop(Activity) void

+ callActivityOnPause(Activity) void

+ getContext() Context

+ callActivityOnPostCreate(Activity, Bundle, PersistableBundle) void

+ callActivityOnPostCreate(Activity, Bundle) void

+ callApplicationOnCreate(Application) void

+ execStartActivity(Context, IBinder, IBinder, Activity, Intent, int, Bundle) ActivityResult

+ newActivity(ClassLoader, String, Intent) Activity

+ callActivityOnDestroy(Activity) void

+ callActivityOnResume(Activity) void

+ callActivityOnCreate(Activity, Bundle, PersistableBundle) void

+ callActivityOnStart(Activity) void

+ newApplication(Class~?~, Context) Application

+ newApplication(ClassLoader, String, Context) Application

}
</code></pre>

</details>

<h2 id="activitythread_1">ActivityThread核心代码<a class="headerlink" href="#activitythread_1" title="Permanent link">&para;</a></h2>
<p><div class="language-java highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ActivityThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ClientTransactionHandler</span><span class="w">  </span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">        </span><span class="kd">implements</span><span class="w"> </span><span class="n">ActivityThreadInternal</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ApplicationThread</span><span class="w"> </span><span class="n">mAppThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ApplicationThread</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="n">mH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">H</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="cm">/**  </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="cm">     * The activities to be truly destroyed (not include relaunch).     */</span><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">ArrayMap</span><span class="o">&lt;</span><span class="n">IBinder</span><span class="p">,</span><span class="w"> </span><span class="n">ActivityClientRecord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mActivities</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ArrayMap</span><span class="o">&lt;&gt;</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="n">Instrumentation</span><span class="w"> </span><span class="n">mInstrumentation</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ActivityClientRecord</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">        </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">IBinder</span><span class="w"> </span><span class="n">token</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">        </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">        </span><span class="n">Activity</span><span class="w"> </span><span class="n">activity</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">        </span><span class="nd">@LifecycleState</span><span class="w">  </span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">        </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">mLifecycleState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PRE_ON_CREATE</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">ActivityClientRecord</span><span class="p">(</span><span class="n">IBinder</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ident</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">                </span><span class="n">ActivityInfo</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">overrideConfig</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">                </span><span class="n">String</span><span class="w"> </span><span class="n">referrer</span><span class="p">,</span><span class="w"> </span><span class="n">IVoiceInteractor</span><span class="w"> </span><span class="n">voiceInteractor</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">                </span><span class="n">PersistableBundle</span><span class="w"> </span><span class="n">persistentState</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ResultInfo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pendingResults</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">                </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ReferrerIntent</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pendingNewIntents</span><span class="p">,</span><span class="w"> </span><span class="n">ActivityOptions</span><span class="w"> </span><span class="n">activityOptions</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">                </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isForward</span><span class="p">,</span><span class="w"> </span><span class="n">ProfilerInfo</span><span class="w"> </span><span class="n">profilerInfo</span><span class="p">,</span><span class="w"> </span><span class="n">ClientTransactionHandler</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="w">                </span><span class="n">IBinder</span><span class="w"> </span><span class="n">assistToken</span><span class="p">,</span><span class="w"> </span><span class="n">IBinder</span><span class="w"> </span><span class="n">shareableActivityToken</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">launchedFromBubble</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">                </span><span class="n">IBinder</span><span class="w"> </span><span class="n">taskFragmentToken</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">            </span><span class="k">this</span><span class="p">.</span><span class="na">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">token</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getLifecycleState</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">mLifecycleState</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setState</span><span class="p">(</span><span class="nd">@LifecycleState</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newLifecycleState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">            </span><span class="n">mLifecycleState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newLifecycleState</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">IApplicationThread</span><span class="p">.</span><span class="na">Stub</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">        </span><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bindApplication</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">ApplicationInfo</span><span class="w"> </span><span class="n">appInfo</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="w">                                          </span><span class="n">String</span><span class="w"> </span><span class="n">sdkSandboxClientAppVolumeUuid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sdkSandboxClientAppPackage</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="w">                                          </span><span class="n">ProviderInfoList</span><span class="w"> </span><span class="n">providerList</span><span class="p">,</span><span class="w"> </span><span class="n">ComponentName</span><span class="w"> </span><span class="n">instrumentationName</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="w">                                          </span><span class="n">ProfilerInfo</span><span class="w"> </span><span class="n">profilerInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">instrumentationArgs</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="w">                                          </span><span class="n">IInstrumentationWatcher</span><span class="w"> </span><span class="n">instrumentationWatcher</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="w">                                          </span><span class="n">IUiAutomationConnection</span><span class="w"> </span><span class="n">instrumentationUiConnection</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">debugMode</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="w">                                          </span><span class="kt">boolean</span><span class="w"> </span><span class="n">enableBinderTracking</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">trackAllocation</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="w">                                          </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isRestrictedBackupMode</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">persistent</span><span class="p">,</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="w">                                          </span><span class="n">CompatibilityInfo</span><span class="w"> </span><span class="n">compatInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="w"> </span><span class="n">services</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">coreSettings</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="w">                                          </span><span class="n">String</span><span class="w"> </span><span class="n">buildSerial</span><span class="p">,</span><span class="w"> </span><span class="n">AutofillOptions</span><span class="w"> </span><span class="n">autofillOptions</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="w">                                          </span><span class="n">ContentCaptureOptions</span><span class="w"> </span><span class="n">contentCaptureOptions</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">[]</span><span class="w"> </span><span class="n">disabledCompatChanges</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="w">                                          </span><span class="n">SharedMemory</span><span class="w"> </span><span class="n">serializedSystemFontMap</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a><span class="w">                                          </span><span class="kt">long</span><span class="w"> </span><span class="n">startRequestedElapsedTime</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">startRequestedUptime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="w">            </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="na">BIND_APPLICATION</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="w">    </span><span class="kd">class</span> <span class="nc">H</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BIND_APPLICATION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">110</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">BIND_APPLICATION</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="w">                    </span><span class="n">AppBindData</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AppBindData</span><span class="p">)</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="w">                    </span><span class="n">handleBindApplication</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="w">            </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleBindApplication</span><span class="p">(</span><span class="n">AppBindData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMessage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMessage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">async</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="w">        </span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">.</span><span class="na">obtain</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="w">        </span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">what</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="w">        </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="w">        </span><span class="n">msg</span><span class="p">.</span><span class="na">arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg1</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="w">        </span><span class="n">msg</span><span class="p">.</span><span class="na">arg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg2</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">async</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a><span class="w">            </span><span class="n">msg</span><span class="p">.</span><span class="na">setAsynchronous</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="w">        </span><span class="n">mH</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">performLaunchActivity</span><span class="p">(</span><span class="n">ActivityClientRecord</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">customIntent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="w">    </span><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">handleLaunchActivity</span><span class="p">(</span><span class="n">ActivityClientRecord</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">                                         </span><span class="n">PendingTransactionActions</span><span class="w"> </span><span class="n">pendingActions</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">deviceId</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">customIntent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="p">}</span>
</span></code></pre></div>
以上代码 ActivityThread 类是我删减后保留核心部分，方便分析。这个代码我就不再解释了，我们直接从一个一个案例中分析。</p>
<h2 id="activitythreadmain">ActivityThread.main()<a class="headerlink" href="#activitythreadmain" title="Permanent link">&para;</a></h2>
<div class="language-java highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="c1">// 创建ActivityThread实例  </span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="n">ActivityThread</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ActivityThread</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="c1">// 附加到ActivityThread实例并传递startSeq  </span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">thread</span><span class="p">.</span><span class="na">attach</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">startSeq</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">    </span><span class="c1">// 启动Looper循环，开始处理消息  </span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="n">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Main thread loop unexpectedly exited&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>这里很简单，就是创建 ActivityThread 实例，并调用其 attach() 方法。</p>
<h3 id="activitythreadattach">ActivityThread.attach()<a class="headerlink" href="#activitythreadattach" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">attach</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">system</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">startSeq</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">system</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">IActivityManager</span><span class="w"> </span><span class="n">mgr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityManager</span><span class="p">.</span><span class="na">getService</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">            </span><span class="n">mgr</span><span class="p">.</span><span class="na">attachApplication</span><span class="p">(</span><span class="n">mAppThread</span><span class="p">,</span><span class="w"> </span><span class="n">startSeq</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">rethrowFromSystemServer</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>通过 IActivityManager 跟 AMS 进行 binder 通讯。
其中 mAppThread 就是 ActivityThread 的内部类 ApplicationThread 。</p>
<h3 id="activitymanagerserviceattachapplication">ActivityManagerService.attachApplication()<a class="headerlink" href="#activitymanagerserviceattachapplication" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">attachApplication</span><span class="p">(</span><span class="n">IApplicationThread</span><span class="w"> </span><span class="n">thread</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">startSeq</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">thread</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">SecurityException</span><span class="p">(</span><span class="s">&quot;Invalid application interface&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">callingPid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Binder</span><span class="p">.</span><span class="na">getCallingPid</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">callingUid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Binder</span><span class="p">.</span><span class="na">getCallingUid</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">origId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Binder</span><span class="p">.</span><span class="na">clearCallingIdentity</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">        </span><span class="n">attachApplicationLocked</span><span class="p">(</span><span class="n">thread</span><span class="p">,</span><span class="w"> </span><span class="n">callingPid</span><span class="p">,</span><span class="w"> </span><span class="n">callingUid</span><span class="p">,</span><span class="w"> </span><span class="n">startSeq</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">        </span><span class="n">Binder</span><span class="p">.</span><span class="na">restoreCallingIdentity</span><span class="p">(</span><span class="n">origId</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>这里的 thread 就是前面传进来的  mAppThread ，也就是 ApplicationThread 。这样 AMS 就拿到了客户端的 binder 对象，就可以通过这个对象跟客户端进程 ipc 通讯了。</p>
<h2 id="amsactivitythread">AMS与ActivityThread通讯<a class="headerlink" href="#amsactivitythread" title="Permanent link">&para;</a></h2>
<p>前面我们分析到了 AMS 拿到客户端的 binder 对象，那么我们现在来分析 AMS 是如何调用到客户端的。</p>
<h3 id="activitymanagerserviceattachapplicationlocked">ActivityManagerService.attachApplicationLocked()<a class="headerlink" href="#activitymanagerserviceattachapplicationlocked" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">attachApplicationLocked</span><span class="p">(</span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">IApplicationThread</span><span class="w"> </span><span class="n">thread</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">callingUid</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">startSeq</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="na">getIsolatedEntryPoint</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">            </span><span class="c1">// This is an isolated process which should just call an entry point instead of  </span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">            </span><span class="c1">// being bound to an application.            thread.runIsolatedEntryPoint(  </span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getIsolatedEntryPoint</span><span class="p">(),</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getIsolatedEntryPointArgs</span><span class="p">());</span><span class="w">  </span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">instr2</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">            </span><span class="n">thread</span><span class="p">.</span><span class="na">bindApplication</span><span class="p">(</span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">appInfo</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">sdkSandboxClientAppVolumeUuid</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">sdkSandboxClientAppPackage</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">                    </span><span class="n">providerList</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">                    </span><span class="n">instr2</span><span class="p">.</span><span class="na">mClass</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">                    </span><span class="n">profilerInfo</span><span class="p">,</span><span class="w"> </span><span class="n">instr2</span><span class="p">.</span><span class="na">mArguments</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">                    </span><span class="n">instr2</span><span class="p">.</span><span class="na">mWatcher</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">                    </span><span class="n">instr2</span><span class="p">.</span><span class="na">mUiAutomationConnection</span><span class="p">,</span><span class="w"> </span><span class="n">testMode</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">                    </span><span class="n">mBinderTransactionTrackingEnabled</span><span class="p">,</span><span class="w"> </span><span class="n">enableTrackAllocation</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">                    </span><span class="n">isRestrictedBackupMode</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">normalMode</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">isPersistent</span><span class="p">(),</span><span class="w">  </span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="na">getWindowProcessController</span><span class="p">().</span><span class="na">getConfiguration</span><span class="p">()),</span><span class="w">  </span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getCompat</span><span class="p">(),</span><span class="w"> </span><span class="n">getCommonServicesLocked</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="na">isolated</span><span class="p">),</span><span class="w">  </span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">                    </span><span class="n">mCoreSettingsObserver</span><span class="p">.</span><span class="na">getCoreSettingsLocked</span><span class="p">(),</span><span class="w">  </span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">                    </span><span class="n">buildSerial</span><span class="p">,</span><span class="w"> </span><span class="n">autofillOptions</span><span class="p">,</span><span class="w"> </span><span class="n">contentCaptureOptions</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getDisabledCompatChanges</span><span class="p">(),</span><span class="w"> </span><span class="n">serializedSystemFontMap</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getStartElapsedTime</span><span class="p">(),</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getStartUptime</span><span class="p">());</span><span class="w">  </span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">            </span><span class="n">thread</span><span class="p">.</span><span class="na">bindApplication</span><span class="p">(</span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">appInfo</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">sdkSandboxClientAppVolumeUuid</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">sdkSandboxClientAppPackage</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">                    </span><span class="n">providerList</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">profilerInfo</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="n">testMode</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">                    </span><span class="n">mBinderTransactionTrackingEnabled</span><span class="p">,</span><span class="w"> </span><span class="n">enableTrackAllocation</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">                    </span><span class="n">isRestrictedBackupMode</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">normalMode</span><span class="p">,</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">isPersistent</span><span class="p">(),</span><span class="w">  </span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">                    </span><span class="k">new</span><span class="w"> </span><span class="n">Configuration</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="na">getWindowProcessController</span><span class="p">().</span><span class="na">getConfiguration</span><span class="p">()),</span><span class="w">  </span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getCompat</span><span class="p">(),</span><span class="w"> </span><span class="n">getCommonServicesLocked</span><span class="p">(</span><span class="n">app</span><span class="p">.</span><span class="na">isolated</span><span class="p">),</span><span class="w">  </span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">                    </span><span class="n">mCoreSettingsObserver</span><span class="p">.</span><span class="na">getCoreSettingsLocked</span><span class="p">(),</span><span class="w">  </span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">                    </span><span class="n">buildSerial</span><span class="p">,</span><span class="w"> </span><span class="n">autofillOptions</span><span class="p">,</span><span class="w"> </span><span class="n">contentCaptureOptions</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getDisabledCompatChanges</span><span class="p">(),</span><span class="w"> </span><span class="n">serializedSystemFontMap</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">                    </span><span class="n">app</span><span class="p">.</span><span class="na">getStartElapsedTime</span><span class="p">(),</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getStartUptime</span><span class="p">());</span><span class="w">  </span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">        </span><span class="k">return</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="p">}</span>
</span></code></pre></div>
<p>现在我们只需知道，这段程序会走到 else 即可。</p>
<p>因为 ApplicationThread 继承了 IApplicationThread.Stub ，使用这里就可以通过 binder 调用到 ApplicationThread 的 bindApplication() 方法中。</p>
<h3 id="applicationthreadbindapplication">ApplicationThread.bindApplication()<a class="headerlink" href="#applicationthreadbindapplication" title="Permanent link">&para;</a></h3>
<p><div class="language-java highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">private</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">IApplicationThread</span><span class="p">.</span><span class="na">Stub</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">    </span><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bindApplication</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">ApplicationInfo</span><span class="w"> </span><span class="n">appInfo</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">                                      </span><span class="n">String</span><span class="w"> </span><span class="n">sdkSandboxClientAppVolumeUuid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">sdkSandboxClientAppPackage</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">                                      </span><span class="n">ProviderInfoList</span><span class="w"> </span><span class="n">providerList</span><span class="p">,</span><span class="w"> </span><span class="n">ComponentName</span><span class="w"> </span><span class="n">instrumentationName</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">                                      </span><span class="n">ProfilerInfo</span><span class="w"> </span><span class="n">profilerInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">instrumentationArgs</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">                                      </span><span class="n">IInstrumentationWatcher</span><span class="w"> </span><span class="n">instrumentationWatcher</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">                                      </span><span class="n">IUiAutomationConnection</span><span class="w"> </span><span class="n">instrumentationUiConnection</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">debugMode</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">                                      </span><span class="kt">boolean</span><span class="w"> </span><span class="n">enableBinderTracking</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">trackAllocation</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">                                      </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isRestrictedBackupMode</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">persistent</span><span class="p">,</span><span class="w"> </span><span class="n">Configuration</span><span class="w"> </span><span class="n">config</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">                                      </span><span class="n">CompatibilityInfo</span><span class="w"> </span><span class="n">compatInfo</span><span class="p">,</span><span class="w"> </span><span class="n">Map</span><span class="w"> </span><span class="n">services</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">coreSettings</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">                                      </span><span class="n">String</span><span class="w"> </span><span class="n">buildSerial</span><span class="p">,</span><span class="w"> </span><span class="n">AutofillOptions</span><span class="w"> </span><span class="n">autofillOptions</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">                                      </span><span class="n">ContentCaptureOptions</span><span class="w"> </span><span class="n">contentCaptureOptions</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="o">[]</span><span class="w"> </span><span class="n">disabledCompatChanges</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">                                      </span><span class="n">SharedMemory</span><span class="w"> </span><span class="n">serializedSystemFontMap</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">                                      </span><span class="kt">long</span><span class="w"> </span><span class="n">startRequestedElapsedTime</span><span class="p">,</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="n">startRequestedUptime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">        </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">H</span><span class="p">.</span><span class="na">BIND_APPLICATION</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a><span class="p">}</span>
</span></code></pre></div>
这样就可以通过 system_server 进程的 AMS 通过 binder 跨进程调到了  ApplicationThread.bindApplication()，但此时是运行中 binder 线程中。</p>
<p>所以需要切到主线去操作。</p>
<h2 id="_3">主线程<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>子线程切换到主线程的操作就很简单了，做过 Android 开发的对 Handler 的使用都不陌生。</p>
<p>前面讲到的 ApplicationThread.bindApplication() ，最后是通过调用 sendMessage() 给 Handler 发送一条消息。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">sendMessage</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">H</span><span class="p">.</span><span class="na">BIND_APPLICATION</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span></code></pre></div>
<h3 id="activitythreadsendmessage">ActivityThread.sendMessage()<a class="headerlink" href="#activitythreadsendmessage" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMessage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">}</span><span class="w">  </span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">sendMessage</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">what</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">arg2</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">async</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Message</span><span class="p">.</span><span class="na">obtain</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">what</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="na">arg1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg1</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="n">msg</span><span class="p">.</span><span class="na">arg2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arg2</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">async</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">        </span><span class="n">msg</span><span class="p">.</span><span class="na">setAsynchronous</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="w">    </span><span class="n">mH</span><span class="p">.</span><span class="na">sendMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="p">}</span>
</span></code></pre></div>
<p>这里的 mH 就是 ActivityThread 的一个内部类 H(Handler)</p>
<h3 id="hhandlemessage">H.handleMessage()<a class="headerlink" href="#hhandlemessage" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ActivityThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">ClientTransactionHandler</span><span class="w">  </span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">        </span><span class="kd">implements</span><span class="w"> </span><span class="n">ActivityThreadInternal</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="nd">@UnsupportedAppUsage</span><span class="w">  </span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="n">mH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">H</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="kd">class</span> <span class="nc">H</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Handler</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">BIND_APPLICATION</span><span class="w">        </span><span class="o">=</span><span class="w"> </span><span class="mi">110</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">                </span><span class="k">case</span><span class="w"> </span><span class="n">BIND_APPLICATION</span><span class="p">:</span><span class="w">  </span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">                    </span><span class="n">Trace</span><span class="p">.</span><span class="na">traceBegin</span><span class="p">(</span><span class="n">Trace</span><span class="p">.</span><span class="na">TRACE_TAG_ACTIVITY_MANAGER</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;bindApplication&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">                    </span><span class="n">AppBindData</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">AppBindData</span><span class="p">)</span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">                    </span><span class="n">handleBindApplication</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">                    </span><span class="n">Trace</span><span class="p">.</span><span class="na">traceEnd</span><span class="p">(</span><span class="n">Trace</span><span class="p">.</span><span class="na">TRACE_TAG_ACTIVITY_MANAGER</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">            </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="p">}</span>
</span></code></pre></div>
<p>H 类接到消息后，调用 ActivityThread.handleBindApplication()。
所以 handleBindApplication() 方法就运行在主线程中了。</p>
<h2 id="instrumentation_1">Instrumentation<a class="headerlink" href="#instrumentation_1" title="Permanent link">&para;</a></h2>
<p>Instrumentation 的初始化就是在 ActivityThread.handleBindApplication() 中进行的。</p>
<div class="language-java highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleBindApplication</span><span class="p">(</span><span class="n">AppBindData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="c1">// Instrumentation info affects the class loader, so load it before  </span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="c1">// setting up the app context.    final InstrumentationInfo ii;  </span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">instrumentationName</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">        </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prepareInstrumentation</span><span class="p">(</span><span class="n">data</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="w">        </span><span class="n">ii</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="w">    </span><span class="c1">// Continue loading instrumentation.  </span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ii</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">        </span><span class="n">initInstrumentation</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">appContext</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">        </span><span class="n">mInstrumentation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Instrumentation</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="w">        </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">basicInit</span><span class="p">(</span><span class="k">this</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="w">        </span><span class="c1">// Do this after providers, since instrumentation tests generally start their  </span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="w">        </span><span class="c1">// test thread at this point, and we don&#39;t want that racing.        try {  </span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="w">            </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">onCreate</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="na">instrumentationArgs</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="w">        </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="w">  </span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="w">                </span><span class="s">&quot;Exception thrown in onCreate() of &quot;</span><span class="w">  </span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="na">instrumentationName</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="w">            </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">callApplicationOnCreate</span><span class="p">(</span><span class="n">app</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">onException</span><span class="p">(</span><span class="n">app</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="w">                </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="w">  </span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="w">                  </span><span class="s">&quot;Unable to create application &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">app</span><span class="p">.</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">()</span><span class="w">  </span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="w">                  </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="na">toString</span><span class="p">(),</span><span class="w"> </span><span class="n">e</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="w">            </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="p">}</span>
</span></code></pre></div>
<p>AMS 调用 ApplicationThread.bindApplication() 传进来的 ComponentName testName 是 null ，所以这里的 data.instrumentationName 是 null 。</p>
<p>所有这段代码最终是调</p>
<p><div class="language-java highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">mInstrumentation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Instrumentation</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">basicInit</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></code></pre></div>
 初始化 Instrumentation。</p>
<p>前面的类图也提到了ActivityThread 有一个重要的成员变量 mInstrumentation。
ActivityThread 调用 Activity 的生命周期就是通过 Instrumentation 做个执行的。</p>
<h2 id="activitythreadactivity">ActivityThread执行Activity生命周期<a class="headerlink" href="#activitythreadactivity" title="Permanent link">&para;</a></h2>
<p>在前面的 <a href="../client_transaction/">Activity框架01-客户端事务管理</a> 分析中，我们提到了 system_server 会通过ClientTransaction 调用到每个 item 的 execute()，从而走到 ActivityThread 去执行 Activity 的生命周期。</p>
<p>之前我们只是一笔带过，没有去分析 ActivityThread 如何调用 Activity 的生命周期，这次我们就来分析这一细节。</p>
<h3 id="activitythreadhandlelaunchactivity">ActivityThread.handleLaunchActivity()<a class="headerlink" href="#activitythreadhandlelaunchactivity" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nd">@Override</span><span class="w">  </span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="kd">public</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">handleLaunchActivity</span><span class="p">(</span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">ActivityClientRecord</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">                                     </span><span class="n">PendingTransactionActions</span><span class="w"> </span><span class="n">pendingActions</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">deviceId</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">customIntent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performLaunchActivity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">customIntent</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="p">}</span>
</span></code></pre></div>
<p>我们接着看 performLaunchActivity()。</p>
<h3 id="activitythreadperformlaunchactivity">ActivityThread.performLaunchActivity()<a class="headerlink" href="#activitythreadperformlaunchactivity" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kd">private</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">performLaunchActivity</span><span class="p">(</span><span class="n">ActivityClientRecord</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">customIntent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">ActivityInfo</span><span class="w"> </span><span class="n">aInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">activityInfo</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="n">ContextImpl</span><span class="w"> </span><span class="n">appContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">createBaseContextForActivity</span><span class="p">(</span><span class="n">r</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span><span class="n">Activity</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">        </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">ClassLoader</span><span class="w"> </span><span class="n">cl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appContext</span><span class="p">.</span><span class="na">getClassLoader</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="n">activity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">newActivity</span><span class="p">(</span><span class="w">  </span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">                </span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="p">.</span><span class="na">getClassName</span><span class="p">(),</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">intent</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">        </span><span class="n">Application</span><span class="w"> </span><span class="n">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">packageInfo</span><span class="p">.</span><span class="na">makeApplicationInner</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="n">mInstrumentation</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">        </span><span class="kd">synchronized</span><span class="w"> </span><span class="p">(</span><span class="n">mResourcesManager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">            </span><span class="n">mActivities</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">token</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activity</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">            </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">isPersistable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="w">                </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">callActivityOnCreate</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">state</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">persistentState</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#__codelineno-12-30"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#__codelineno-12-31"></a><span class="w">                </span><span class="n">mInstrumentation</span><span class="p">.</span><span class="na">callActivityOnCreate</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">.</span><span class="na">state</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#__codelineno-12-32"></a><span class="w">            </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#__codelineno-12-33"></a><span class="w">            </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#__codelineno-12-34"></a><span class="w">        </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#__codelineno-12-35"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#__codelineno-12-36"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">SuperNotCalledException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#__codelineno-12-37"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#__codelineno-12-38"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">Exception</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#__codelineno-12-39"></a><span class="w">        </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#__codelineno-12-40"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#__codelineno-12-41"></a>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#__codelineno-12-42"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">activity</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#__codelineno-12-43"></a><span class="p">}</span>
</span></code></pre></div>
<p>这里只保留 performLaunchActivity() 核心代码，我们这里只关心 Activity。</p>
<p>首先是通过 Instrumentation.newActivity() 去创建一个 Activity；其次再通过 Instrumentation.callActivityOnCreate() 去调用 Activity 的 onCreate() 方法。</p>
<h3 id="instrumentationnewactivity">Instrumentation.newActivity()<a class="headerlink" href="#instrumentationnewactivity" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">public</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">newActivity</span><span class="p">(</span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">                            </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">        </span><span class="kd">throws</span><span class="w"> </span><span class="n">InstantiationException</span><span class="p">,</span><span class="w"> </span><span class="n">IllegalAccessException</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">        </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="c1">// 获取包名，如果intent和其组件不为空，则获取组件的包名，否则为null</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">pkg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">intent</span><span class="p">.</span><span class="na">getComponent</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w">  </span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">            </span><span class="o">?</span><span class="w"> </span><span class="n">intent</span><span class="p">.</span><span class="na">getComponent</span><span class="p">().</span><span class="na">getPackageName</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="c1">// 使用包名获取对应的AppComponentFactory，并通过它来实例化Activity</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">getFactory</span><span class="p">(</span><span class="n">pkg</span><span class="p">).</span><span class="na">instantiateActivity</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="n">className</span><span class="p">,</span><span class="w"> </span><span class="n">intent</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">}</span><span class="w">  </span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">AppComponentFactory</span><span class="w"> </span><span class="nf">getFactory</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">pkg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="w">    </span><span class="c1">// 如果包名为null，输出错误日志，并返回默认的AppComponentFactory</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pkg</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No pkg specified, disabling AppComponentFactory&quot;</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">AppComponentFactory</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="w">    </span><span class="c1">// 如果ActivityThread未初始化，输出错误日志，并返回默认的AppComponentFactory</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mThread</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="w">        </span><span class="n">Log</span><span class="p">.</span><span class="na">e</span><span class="p">(</span><span class="n">TAG</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Uninitialized ActivityThread, likely app-created Instrumentation,&quot;</span><span class="w">  </span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="w">                </span><span class="o">+</span><span class="w"> </span><span class="s">&quot; disabling AppComponentFactory&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Throwable</span><span class="p">());</span><span class="w">  </span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">AppComponentFactory</span><span class="p">.</span><span class="na">DEFAULT</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">    </span><span class="c1">// 通过包名获取LoadedApk对象</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="w">    </span><span class="n">LoadedApk</span><span class="w"> </span><span class="n">apk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mThread</span><span class="p">.</span><span class="na">peekPackageInfo</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="w">    </span><span class="c1">// 如果获取到的apk为null，获取系统上下文的PackageInfo</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">apk</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">apk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mThread</span><span class="p">.</span><span class="na">getSystemContext</span><span class="p">().</span><span class="na">mPackageInfo</span><span class="p">;</span><span class="w">  </span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="w">    </span><span class="c1">// 返回apk对应的AppComponentFactory</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">apk</span><span class="p">.</span><span class="na">getAppFactory</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="p">}</span><span class="w">  </span>
</span></code></pre></div>
<h4 id="appcomponentfactoryinstantiateactivity">AppComponentFactory.instantiateActivity()<a class="headerlink" href="#appcomponentfactoryinstantiateactivity" title="Permanent link">&para;</a></h4>
<div class="language-java highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">AppComponentFactory</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="cm">/**</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="cm">     * 允许应用程序覆盖Activity的创建。这可以用于执行诸如依赖注入或类加载器</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="cm">     * 更改等操作。</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="cm">     *</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="cm">     * &lt;p&gt;此方法仅用于提供实例化的钩子。它不会提供对Activity对象的提前访问。</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="cm">     * 返回的对象尚未初始化为Context，不应用于与其他Android API交互。</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="cm">     *</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="cm">     * @param cl        用于实例化的默认类加载器。</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="cm">     * @param className 要实例化的类名。</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="cm">     * @param intent    创建类的Intent。</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="cm">     * @return 新创建的Activity实例。</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="cm">     * @throws InstantiationException 如果无法实例化类。</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="cm">     * @throws IllegalAccessException 如果没有权限访问类或其空构造函数。</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="cm">     * @throws ClassNotFoundException 如果找不到类。</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="cm">     */</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">Activity</span><span class="w"> </span><span class="nf">instantiateActivity</span><span class="p">(</span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">ClassLoader</span><span class="w"> </span><span class="n">cl</span><span class="p">,</span><span class="w"> </span><span class="nd">@NonNull</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">className</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">                                                 </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">            </span><span class="kd">throws</span><span class="w"> </span><span class="n">InstantiationException</span><span class="p">,</span><span class="w"> </span><span class="n">IllegalAccessException</span><span class="p">,</span><span class="w"> </span><span class="n">ClassNotFoundException</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">        </span><span class="c1">// 使用指定的类加载器加载类，并创建该类的新实例</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Activity</span><span class="p">)</span><span class="w"> </span><span class="n">cl</span><span class="p">.</span><span class="na">loadClass</span><span class="p">(</span><span class="n">className</span><span class="p">).</span><span class="na">newInstance</span><span class="p">();</span><span class="w">  </span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="p">}</span>
</span></code></pre></div>
<p>使用传入的类加载器加载指定的类，并通过调用 newInstance() 方法创建该类的新实例。</p>
<h3 id="instrumentationcallactivityoncreate">Instrumentation.callActivityOnCreate()<a class="headerlink" href="#instrumentationcallactivityoncreate" title="Permanent link">&para;</a></h3>
<div class="language-java highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="cm">/**</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="cm"> * 调用一个活动（Activity）的 {@link Activity#onCreate} 方法。</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="cm"> * 默认实现只是简单地调用该方法。</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="cm"> *</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="cm"> * @param activity 正在创建的活动实例。</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="cm"> * @param icicle 之前冻结的状态（或者为 null），将传递给 onCreate() 方法。</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="cm"> */</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">callActivityOnCreate</span><span class="p">(</span><span class="n">Activity</span><span class="w"> </span><span class="n">activity</span><span class="p">,</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">icicle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">    </span><span class="c1">// 在调用活动的 onCreate() 方法之前进行的操作。</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">    </span><span class="n">prePerformCreate</span><span class="p">(</span><span class="n">activity</span><span class="p">);</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">    </span><span class="c1">// 调用活动的 performCreate() 方法，这实际上是调用活动的 onCreate() 方法。</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="n">activity</span><span class="p">.</span><span class="na">performCreate</span><span class="p">(</span><span class="n">icicle</span><span class="p">);</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="c1">// 在调用活动的 onCreate() 方法之后进行的操作。</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span><span class="n">postPerformCreate</span><span class="p">(</span><span class="n">activity</span><span class="p">);</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="activityperformcreate">Activity.performCreate()<a class="headerlink" href="#activityperformcreate" title="Permanent link">&para;</a></h4>
<div class="language-java highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">performCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">icicle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="n">performCreate</span><span class="p">(</span><span class="n">icicle</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="p">}</span><span class="w">  </span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nd">@UnsupportedAppUsage</span><span class="p">(</span><span class="n">maxTargetSdk</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Build</span><span class="p">.</span><span class="na">VERSION_CODES</span><span class="p">.</span><span class="na">R</span><span class="p">,</span><span class="w"> </span><span class="n">trackingBug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">170729553</span><span class="p">)</span><span class="w">  </span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">performCreate</span><span class="p">(</span><span class="n">Bundle</span><span class="w"> </span><span class="n">icicle</span><span class="p">,</span><span class="w"> </span><span class="n">PersistableBundle</span><span class="w"> </span><span class="n">persistentState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">persistentState</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">        </span><span class="n">onCreate</span><span class="p">(</span><span class="n">icicle</span><span class="p">,</span><span class="w"> </span><span class="n">persistentState</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">        </span><span class="n">onCreate</span><span class="p">(</span><span class="n">icicle</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="p">}</span><span class="w">  </span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="p">...</span><span class="w">  </span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="activityoncreate">Activity.onCreate()<a class="headerlink" href="#activityoncreate" title="Permanent link">&para;</a></h4>
<div class="language-java highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nd">@MainThread</span><span class="w">  </span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nd">@CallSuper</span><span class="w">  </span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">}</span><span class="w">  </span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onCreate</span><span class="p">(</span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">Bundle</span><span class="w"> </span><span class="n">savedInstanceState</span><span class="p">,</span><span class="w">  </span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">        </span><span class="nd">@Nullable</span><span class="w"> </span><span class="n">PersistableBundle</span><span class="w"> </span><span class="n">persistentState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">    </span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">);</span><span class="w">  </span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="p">}</span>
</span></code></pre></div>
<h2 id="_4">总结<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>ActivityThread 的内部类 ApplicationThread 是继承 IApplicationThread.Stub，主要是通过 AMS 与客户端通信的通道。</p>
</li>
<li>
<p>ActivityThread 的内部类 H(Handler) 主要是把 binder 线程切到主线程再做对应的操作。</p>
</li>
<li>
<p>ActivityThread 的内部类 ActivityClientRecord 是 app 端 Activity 和 ActivityClientRecord 是一一对应的。在 <a href="../activity_client_record/">Activity框架02-ActivityClientRecord</a> 有详细分析。</p>
</li>
<li>
<p>ActivityThread 通过成员变量 mInstrumentation 来创建 Activity 并调用其生命周期。</p>
</li>
</ul>







  
  






  <h2 id="__comments">评论</h2>
  <!-- Insert generated snippet here -->

    <script src="https://giscus.app/client.js"
        data-repo="i-rtfsc/i-rtfsc.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxNTU2NzA2OTE="
        data-category="Q&A"
        data-category-id="DIC_kwDOCUdYo84CeZYU"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="preferred_color_scheme"
        data-lang="zh-CN"
        data-loading="lazy"
        data-default-reactions-enabled="1"
        crossorigin="anonymous"
        async>
    </script>

  <!-- Synchronize Giscus theme with palette -->
  <script>
    var giscus = document.querySelector("script[src*=giscus]")

    // Set palette on initial load
    var palette = __md_get("__palette")
    if (palette && typeof palette.color === "object") {
      var theme = palette.color.scheme === "slate"
        ? "transparent_dark"
        : "light"

      // Instruct Giscus to set theme
      giscus.setAttribute("data-theme", theme)
    }

    // Register event handlers after documented loaded
    document.addEventListener("DOMContentLoaded", function() {
      var ref = document.querySelector("[data-md-component=palette]")
      ref.addEventListener("change", function() {
        var palette = __md_get("__palette")
        if (palette && typeof palette.color === "object") {
          var theme = palette.color.scheme === "slate"
            ? "transparent_dark"
            : "light"

          // Instruct Giscus to change theme
          var frame = document.querySelector(".giscus-frame")
          frame.contentWindow.postMessage(
            { giscus: { setConfig: { theme } } },
            "https://giscus.app"
          )
        }
      })
    })
  </script>


<script src="//code.tidio.co/rqu0g9yeqzoipyjjehe84aqmiqt1ap9r.js" async></script>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
    
    
    
    <nav class="md-footer__inner md-grid" aria-label="页脚" >
        
        
        <a href="../activity_client_record/" class="md-footer__link md-footer__link--prev"
           aria-label="上一页: Activity框架02-ActivityClientRecord">
            <div class="md-footer__button md-icon">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                上一页
              </span>
                <div class="md-ellipsis">
                    Activity框架02-ActivityClientRecord
                </div>
            </div>
        </a>
        
        
        
        <a href="../activity_context/" class="md-footer__link md-footer__link--next"
           aria-label="下一页: Activity框架04-Activity和Context的关系">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                下一页
              </span>
                <div class="md-ellipsis">
                    Activity框架04-Activity和Context的关系
                </div>
            </div>
            <div class="md-footer__button md-icon">
                
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
        </a>
        
    </nav>
    
    
    <div class="md-footer-meta md-typeset">
        <div class="md-footer-meta__inner md-grid">
            <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2015-2025 Solo</br>The website content is licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>
    </div>
  
  
</div>

            
            <div class="md-copyright">
    <font size=1>
        
        <a href="https://icp.gov.moe/?keyword=20243250" target="_blank">萌ICP备20243250号</a>
        

        
        <span>&nbsp;|&nbsp;本站访问量：</span>
        <script async src="//finicounter.eu.org/finicounter.js"></script>
        <span id="finicount_views"></span>
        

        
        
        <span>&nbsp;|&nbsp;本站已经运行：</span>
        <span id="uptime"></span>
        <script>
            function calculateUptime() {
                let dateString = '2018-11-1'
                let start = new Date(dateString);
                let currentTime = new Date();
                let difference = currentTime - start;
                let days = Math.floor(difference / (1000 * 60 * 60 * 24));
                document.getElementById('uptime').textContent = days + '天';
            }

            calculateUptime()
        </script>
        
    </font>
</div>
            

            
            <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/i-rtfsc" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<anqi.huang@outlook.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480v-83.6c0-4 1.5-7.8 4.2-10.8l167.6-182.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8l-88.3-44.2C7.1 311.3.3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.9-5.5 34 1.4"/></svg>
    </a>
  
</div>
            
        </div>
    </div>

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.tooltips", "navigation.indexes", "navigation.top", "navigation.footer", "navigation.tracking", "navigation.path", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tabs", "navigation.tabs.sticky", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "tags": {"Default": "default-tag", "Hardware": "hardware-tag", "Software": "software-tag"}, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.60a45f97.min.js"></script>
      
        <script src="../../../javascripts/extra.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mermaid@10.0.2/dist/add-html-label-6e56ed67.min.js"></script>
      
    
  </body>
</html>